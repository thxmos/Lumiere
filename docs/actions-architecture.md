# Actions Architecture

![Actions Architecture](./assets/actions-architecture-1.png)

Eraser Diagram: https://app.eraser.io/workspace/htbg7wsxwgzT8EP78cuJ

## Layers

| Layer                           | Responsibilities                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| ------------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **component.tsx**               | - Calls `component.actions.ts` or `@/actions/entity.actions.ts` directly to interact with server<br>- Responsible for ui, state, and form logic only                                                                                                                                                                                                                                                                                                     |
| **./component.actions.ts**      | - Logic specific for its respective component ie. updateUserTheme is a partial update using updateUser() in @/actions<br>- Filter out irrelevant or sensitive info for each use case<br>- Database transactions (multi query)<br>&nbsp;&nbsp;- ie. Image upload needs to upload to blob, create new Image entity tied to user in db, and on failure rollback<br>- Don't error handle here, let errors cascade to the component<br>- Display toasts here? |
| **@/actions/entity.actions.ts** | - Validate session<br>- Handle ACAB<br>- Handle errors here<br>- Protect data-access layer<br>- Modified CRUD operations from data-access layer ie. getLinksByUserId<br>- Atomic transactions (one thing at a time)                                                                                                                                                                                                                                      |
| **Data Access Layer**           | - ORM implementation<br>- Direct to DB                                                                                                                                                                                                                                                                                                                                                                                                                   |
